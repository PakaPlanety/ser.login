<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบบันทึกใบรับซ่อม</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <div id="loading">กำลังโหลดข้อมูล...</div>

    <script>
        const GAS_WEBHOOK_URL = "https://script.google.com/a/macros/cst.co.th/s/AKfycbyHkVprZaygjabYsFWwfTYW-QN73dvcXhCqsQYsfcn8zCO2Nx7yk_h5j_ZsKzQeYfYE9Q/exec"; // เปลี่ยนเป็น Webhook URL ของ Google Apps Script
        const FORM_URL = "https://docs.google.com/forms/d/1EpYWURCtAhPYh1arJnC2dpABaSma_4i-N0NkZQ0272U/prefill"; // เปลี่ยนเป็น Google Form ของคุณ
        const LIFF_ID = "2006858965-zwJ5PVO6"; // เปลี่ยนเป็น LIFF ID ของคุณ

        liff.init({ liffId: LIFF_ID })
            .then(() => {
                if (!liff.isLoggedIn()) {
                    console.log("User not logged in, redirecting to login...");
                    liff.login();
                    return;
                }

                console.log("User is logged in, fetching profile...");
                liff.getProfile()
                    .then(profile => {
                        console.log("LIFF Profile Data:", profile);

                        // ✅ ส่งข้อมูลไป Google Sheets
                        fetch(GAS_WEBHOOK_URL, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                userId: profile.userId,
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log("Google Sheets Response:", data);
                            if (data.status === "success") {
                                console.log("Data saved successfully! Redirecting to Google Form...");
                                window.location.href = FORM_URL; // ✅ Redirect ไปที่ Google Form
                            } else {
                                console.error("Error saving data:", data.message);
                                document.getElementById('loading').innerText = "เกิดข้อผิดพลาด!";
                            }
                        })
                        .catch(error => console.error("Error sending data:", error));
                    })
                    .catch(err => console.error("Error getting profile:", err));
            })
            .catch(err => console.error("LIFF Initialization failed", err));
    </script>
</body>
</html>

</body>
</html>
